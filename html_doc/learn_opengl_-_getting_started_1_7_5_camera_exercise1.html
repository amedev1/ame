<!DOCTYPE html>
<!-- Generated by ame util library - using PrismJS 1.20.0 -->
<html>
<head>
	<meta charset="UTF-8">
	<title>Another Memory Ends</title>
	<link rel="stylesheet" type="text/css" href="../CSS/docgen_style.css">
	<link rel="stylesheet" type="text/css" href="../CSS/prism.css">
</head>
<body>
	<script src="../JS/prism.js">
	</script>
	<h1>1_7_5_camera_exercise1</h1>
	<br>
	<p></p>
	<br>
	<section class="main">
		<h2 id="learn_opengl_-_getting_started_1_7_5_camera_exercise1_result">result</h2>
		<img src="../res/1_7_5_camera_exercise1.gif" alt="result">
		<h2 id="learn_opengl_-_getting_started_1_7_5_camera_exercise1_source">source</h2>
		<pre><code class="language-c">/*
 * 1_7_5_camera_exercise1.c
 * Another Memory Ends - amedevcentral@gmail.com
 * Copyright
 * based on LearnOpenGL https://learnopengl.com/Getting-started/Camera
 * by Joey de Vries https://twitter.com/JoeyDeVriez
 * license https://creativecommons.org/licenses/by-nc/4.0/legalcode
 */
#include "framework.h"

const size_t gc_core_memory_size = 0;

void resize_callback(AmeWindow* window, uint width, uint height);
void input_callback(AmeWindow* window, const InputEvent* event);

vec3 camera_pos = { 0.0f, 0.0f, 3.0f };
vec3 camera_front = { 0.0f, 0.0f, -1.0f };
vec3 camera_up = { 0.0f, 1.0f, 0.0f };

float yaw = -90.0f;
float pitch = 0.0f;
float fov = 45.0f;

float delta_time = 0.0f;
float last_frame = 0.0f;

int main(int argc, char** argv)
{
	(void)argc;
	(void)argv;
	f_initialize(C_OUTPUT_FULL, 0);

	AmeWindow *window = f_window_create("graphics_1_start_7_5_camera_exercise1", 800, 600, WINDOW_STYLE_FIXED);
	f_window_set_input_callback(window, input_callback);
	f_window_set_resize_callback(window, resize_callback);
	f_window_cursor_mode(window, CURSOR_DISABLE);
	f_window_set_current(window);

	ColorVec4 clear_color = { 0.5f, 0.7f, 0.8f, 1.0f };
	gfx_clear_color_set(clear_color);

	gfx_id shader = gfx_shader_create_from_files("./1_7_5_vertex.glsl", "./1_7_5_fragment.glsl", &gc_gfx_shader_link_default);

	GfxAttributeFormat format = C_GFX_FORMAT_NULL;
	gfx_attribute_add(&format, "pos", GFX_ATTRIBUTE_VEC3);
	gfx_attribute_add(&format, "uv", GFX_ATTRIBUTE_VEC2);

	gfx_id vertex_array = gfx_vertex_array_create();
	gfx_id vertex_buffer = gfx_vertex_buffer_create();

	gfx_vertex_array_bind(vertex_array);
	gfx_vertex_buffer_bind(vertex_buffer);
	gfx_attributes_enable_interleaved(&format);

	float vertices[] = {
		-0.5f, -0.5f, -0.5f,  0.0f, 0.0f,
		0.5f, -0.5f, -0.5f,  1.0f, 0.0f,
		0.5f,  0.5f, -0.5f,  1.0f, 1.0f,
		0.5f,  0.5f, -0.5f,  1.0f, 1.0f,
		-0.5f,  0.5f, -0.5f,  0.0f, 1.0f,
		-0.5f, -0.5f, -0.5f,  0.0f, 0.0f,

		-0.5f, -0.5f,  0.5f,  0.0f, 0.0f,
		0.5f, -0.5f,  0.5f,  1.0f, 0.0f,
		0.5f,  0.5f,  0.5f,  1.0f, 1.0f,
		0.5f,  0.5f,  0.5f,  1.0f, 1.0f,
		-0.5f,  0.5f,  0.5f,  0.0f, 1.0f,
		-0.5f, -0.5f,  0.5f,  0.0f, 0.0f,

		-0.5f,  0.5f,  0.5f,  1.0f, 0.0f,
		-0.5f,  0.5f, -0.5f,  1.0f, 1.0f,
		-0.5f, -0.5f, -0.5f,  0.0f, 1.0f,
		-0.5f, -0.5f, -0.5f,  0.0f, 1.0f,
		-0.5f, -0.5f,  0.5f,  0.0f, 0.0f,
		-0.5f,  0.5f,  0.5f,  1.0f, 0.0f,

		0.5f,  0.5f,  0.5f,  1.0f, 0.0f,
		0.5f,  0.5f, -0.5f,  1.0f, 1.0f,
		0.5f, -0.5f, -0.5f,  0.0f, 1.0f,
		0.5f, -0.5f, -0.5f,  0.0f, 1.0f,
		0.5f, -0.5f,  0.5f,  0.0f, 0.0f,
		0.5f,  0.5f,  0.5f,  1.0f, 0.0f,

		-0.5f, -0.5f, -0.5f,  0.0f, 1.0f,
		0.5f, -0.5f, -0.5f,  1.0f, 1.0f,
		0.5f, -0.5f,  0.5f,  1.0f, 0.0f,
		0.5f, -0.5f,  0.5f,  1.0f, 0.0f,
		-0.5f, -0.5f,  0.5f,  0.0f, 0.0f,
		-0.5f, -0.5f, -0.5f,  0.0f, 1.0f,

		-0.5f,  0.5f, -0.5f,  0.0f, 1.0f,
		0.5f,  0.5f, -0.5f,  1.0f, 1.0f,
		0.5f,  0.5f,  0.5f,  1.0f, 0.0f,
		0.5f,  0.5f,  0.5f,  1.0f, 0.0f,
		-0.5f,  0.5f,  0.5f,  0.0f, 0.0f,
		-0.5f,  0.5f, -0.5f,  0.0f, 1.0f
	};

	gfx_vertex_buffer_copy_data((const uint8*)vertices, sizeof(vertices), GFX_BUFFER_STATIC);
	gfx_vertex_array_bind(0);

	GfxTextureParameters param = gc_gfx_texture_parameters_default;
	param.s_wrapping = GFX_TEXTURE_WRAP_STRETCHED_EDGE;
	param.t_wrapping = GFX_TEXTURE_WRAP_STRETCHED_EDGE;
	Image *container = i_image_alloc_from_file("./gfx_test_resources/container.jpg");
	gfx_id texture1 = gfx_texture_import(container, &param);
	i_image_free(container);

	Image *face = i_image_alloc_from_file("./gfx_test_resources/awesomeface.png");
	param.s_wrapping = GFX_TEXTURE_WRAP_REPEAT;
	param.t_wrapping = GFX_TEXTURE_WRAP_REPEAT;
	gfx_id texture2 = gfx_texture_import(face, &param);
	i_image_free(face);

	gfx_shader_use(shader);
	gfx_shader_sampler_2d_set(shader, "texture1", 0);
	gfx_shader_sampler_2d_set(shader, "texture2", 1);

	mat4 model;
	mat4 view;
	mat4 projection;

	gfx_depth_testing(true);

	vec3 cube_positions[] = {
		{ 0.0f,  0.0f,  0.0f },
		{ 2.0f,  5.0f, -15.0f },
		{ -1.5f, -2.2f, -2.5f },
		{ -3.8f, -2.0f, -12.3f },
		{ 2.4f, -0.4f, -3.5f },
		{ -1.7f,  3.0f, -7.5f },
		{ 1.3f, -2.0f, -2.5f },
		{ 1.5f,  2.0f, -2.5f },
		{ 1.5f,  0.2f, -1.5f },
		{ -1.3f,  1.0f, -1.5f }
	};

	while (f_window_should_close(window) == false)
	{
		float current_frame = (float)c_time() / 100.0f;
		delta_time = current_frame - last_frame;
		last_frame = current_frame;

		f_window_process_messages(window);
		gfx_framebuffer_bind(0);
		gfx_clear(true, true, false);
		gfx_texture_activate(0);
		gfx_texture_bind(texture1);
		gfx_texture_activate(1);
		gfx_texture_bind(texture2);
		gfx_shader_use(shader);

		gfx_vertex_array_bind(vertex_array);

		m_mat4_identity(view);

		vec3 at;
		m_vec3_add(camera_pos, camera_front, at);
		m_mat4_look_at_rh(camera_pos, at, camera_up, view);
		gfx_shader_mat4_set(shader, "view", view);

		m_mat4_perspective_fov_rh(m_radians(fov), f_window_aspect(window), 0.1f, 100.0f, projection);
		gfx_shader_mat4_set(shader, "projection", projection);

		vec3 axis = { 1.0f, 0.3f, 0.5f };
		for (uint i = 0; i < 10; ++i)
		{
			m_mat4_identity(model);
			m_mat4_translate(model, cube_positions[i], model);
			float angle = 20.0f * i;
			m_mat4_rotate(model, m_radians(angle), axis, model);
			gfx_shader_mat4_set(shader, "model", model);
			gfx_draw_vertices(GFX_VERTEX_TRIANGLE, 36);
		}
		f_window_swap_buffers(window);
	}

	gfx_shader_delete(shader);
	gfx_vertex_array_delete(vertex_array);
	gfx_vertex_buffer_delete(vertex_buffer);
	gfx_texture_delete(texture1);
	gfx_texture_delete(texture2);

	f_window_delete(window);
	f_terminate();
	return 0;
}

void resize_callback(AmeWindow* window, uint width, uint height)
{
	if (gfx_context_get() == f_window_context(window))
	{
		gfx_viewport_set_values(0, 0, width, height);
	}
}

void input_callback(AmeWindow* window, const InputEvent* event)
{
	float camera_speed  = 2.5f * delta_time;
	vec3 temp;

	switch (event->type)
	{
	case INPUT_EVENT_KEYBOARD_KEY_DOWN:
	{
		VirtualKey key = f_input_event_key(event);
		switch (key)
		{
		case VIRTUAL_KEY_ESC:
		{
			f_window_send_close(window);
		}
		break;
		case VIRTUAL_KEY_W:
		{
			m_vec3_mul_n(camera_front, camera_speed, temp);
			m_vec3_add(camera_pos, temp, camera_pos);
		}
		break;
		case VIRTUAL_KEY_S:
		{
			m_vec3_mul_n(camera_front, camera_speed, temp);
			m_vec3_sub(camera_pos, temp, camera_pos);
		}
		break;
		case VIRTUAL_KEY_A:
		{
			vec3 cross;
			m_vec3_cross(camera_front, camera_up, cross);
			m_vec3_normalize(cross);
			m_vec3_mul_n(cross, camera_speed, temp);
			m_vec3_sub(camera_pos, temp, camera_pos);
		}
		break;
		case VIRTUAL_KEY_D:
		{
			vec3 cross;
			m_vec3_cross(camera_front, camera_up, cross);
			m_vec3_normalize(cross);
			m_vec3_mul_n(cross, camera_speed, temp);
			m_vec3_add(camera_pos, temp, camera_pos);
		}
		break;
		default:
		break;
		}
		camera_pos[1] = 0.0f;
	}
	break;
	case INPUT_EVENT_MOUSE_WHEEL:
	{
		fov -= (float)f_input_event_delta(event);
		if (fov < 1.0f)
			fov = 1.0f;
		if (fov > 45.0f)
			fov = 45.0f;
		break;
	}
	break;
	case INPUT_EVENT_MOUSE_MOVE:
	{
		int dx;
		int dy;
		f_input_event_move_offset(event, &dx, &dy);

		float x_offset = (float)dx;
		float y_offset = (float)dy;

		float sensitivity = 0.1f;
		x_offset *= sensitivity;
		y_offset *= sensitivity;

		yaw += x_offset;
		pitch += y_offset;

		if (pitch > 89.0f)
			pitch = 89.0f;
		if (pitch < -89.0f)
			pitch = -89.0f;

		camera_front[0] = cosf(m_radians(yaw)) * cosf(m_radians(pitch));
		camera_front[1] = sinf(m_radians(pitch));
		camera_front[2] = sinf(m_radians(yaw)) * cosf(m_radians(pitch));
		m_vec3_normalize(camera_front);
	}
	break;
	default:
		break;
	}
}
</code></pre>
		<h2 id="learn_opengl_-_getting_started_1_7_5_camera_exercise1_vertex_shader">vertex_shader</h2>
		<pre><code class="language-glsl">#version 330 core
in vec3 pos;
in vec2 uv;

out vec2 frag_uv;

uniform mat4 model;
uniform mat4 view;
uniform mat4 projection;

void main()
{
  gl_Position = projection * view * model * vec4(pos, 1.0);
  frag_uv = uv;
}</code></pre>
		<h2 id="learn_opengl_-_getting_started_1_7_5_camera_exercise1_fragment_shader">fragment_shader</h2>
		<pre><code class="language-glsl">#version 330 core
out vec4 color;

in vec2 frag_uv;

uniform sampler2D texture1;
uniform sampler2D texture2;

void main()
{
  color = mix(texture(texture1, frag_uv), texture(texture2, frag_uv), 0.2);
}</code></pre>
	</section>
	<nav class="menu">
		<a href="../index.html">Home</a>
		<a href="cmake.html">cmake</a>
		<a href="ftest.html">ftest</a>
		<a href="math.html">math</a>
		<a href="core.html">core</a>
		<a href="image.html">image</a>
		<a href="graphics.html">graphics</a>
		<a href="util.html">util</a>
		<a href="framework.html">framework</a>
		<a href="documentation.html">documentation</a>
		<a href="learn_opengl_-_getting_started.html">learn_opengl - getting started</a>
		<a class="section" href="learn_opengl_-_getting_started_1_1_window.html">1_1_window</a>
		<a class="section" href="learn_opengl_-_getting_started_1_2_1_triangle.html">1_2_1_triangle</a>
		<a class="section" href="learn_opengl_-_getting_started_1_2_2_triangle_indexed.html">1_2_2_triangle_indexed</a>
		<a class="section" href="learn_opengl_-_getting_started_1_2_3_triangle_exercise1.html">1_2_3_triangle_exercise1</a>
		<a class="section" href="learn_opengl_-_getting_started_1_2_4_triangle_exercise2.html">1_2_4_triangle_exercise2</a>
		<a class="section" href="learn_opengl_-_getting_started_1_2_5_triangle_exercise3.html">1_2_5_triangle_exercise3</a>
		<a class="section" href="learn_opengl_-_getting_started_1_3_1_shaders_uniform.html">1_3_1_shaders_uniform</a>
		<a class="section" href="learn_opengl_-_getting_started_1_3_2_shaders_interpolation.html">1_3_2_shaders_interpolation</a>
		<a class="section" href="learn_opengl_-_getting_started_1_3_3_shaders_exercise1.html">1_3_3_shaders_exercise1</a>
		<a class="section" href="learn_opengl_-_getting_started_1_3_4_shaders_exercise2.html">1_3_4_shaders_exercise2</a>
		<a class="section" href="learn_opengl_-_getting_started_1_3_5_shaders_exercise3.html">1_3_5_shaders_exercise3</a>
		<a class="section" href="learn_opengl_-_getting_started_1_4_1_textures.html">1_4_1_textures</a>
		<a class="section" href="learn_opengl_-_getting_started_1_4_2_textures_combined.html">1_4_2_textures_combined</a>
		<a class="section" href="learn_opengl_-_getting_started_1_4_3_textures_exercise1.html">1_4_3_textures_exercise1</a>
		<a class="section" href="learn_opengl_-_getting_started_1_4_4_textures_exercise2.html">1_4_4_textures_exercise2</a>
		<a class="section" href="learn_opengl_-_getting_started_1_4_5_textures_exercise3.html">1_4_5_textures_exercise3</a>
		<a class="section" href="learn_opengl_-_getting_started_1_4_6_textures_exercise4.html">1_4_6_textures_exercise4</a>
		<a class="section" href="learn_opengl_-_getting_started_1_5_1_transformations.html">1_5_1_transformations</a>
		<a class="section" href="learn_opengl_-_getting_started_1_5_2_transformations_exercise1.html">1_5_2_transformations_exercise1</a>
		<a class="section" href="learn_opengl_-_getting_started_1_5_3_transformations_exercise2.html">1_5_3_transformations_exercise2</a>
		<a class="section" href="learn_opengl_-_getting_started_1_6_1_coordinate_systems.html">1_6_1_coordinate_systems</a>
		<a class="section" href="learn_opengl_-_getting_started_1_6_2_coordinate_systems_depth.html">1_6_2_coordinate_systems_depth</a>
		<a class="section" href="learn_opengl_-_getting_started_1_6_3_coordinate_systems_multiple.html">1_6_3_coordinate_systems_multiple</a>
		<a class="section" href="learn_opengl_-_getting_started_1_6_4_coordinate_systems_exercise3.html">1_6_4_coordinate_systems_exercise3</a>
		<a class="section" href="learn_opengl_-_getting_started_1_7_1_camera_circle.html">1_7_1_camera_circle</a>
		<a class="section" href="learn_opengl_-_getting_started_1_7_2_camera_keyboard.html">1_7_2_camera_keyboard</a>
		<a class="section" href="learn_opengl_-_getting_started_1_7_3_camera_mouse_zoom.html">1_7_3_camera_mouse_zoom</a>
		<a class="section" href="learn_opengl_-_getting_started_1_7_4_camera_freefly.html">1_7_4_camera_freefly</a>
		<a class="current_section" href="learn_opengl_-_getting_started_1_7_5_camera_exercise1.html">1_7_5_camera_exercise1</a>
		<a href="learn_opengl_-_lighting.html">learn_opengl - lighting</a>
	</nav>
	<footer>
		<p>Another Memory Ends - Reference</p>
	</footer>
</body>
</html>
